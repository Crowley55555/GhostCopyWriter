# Аудит персональных данных

## Дата проверки: 25 января 2026 г.

## Собираемые персональные данные

### 1. Telegram User ID ✅
- **Где собирается:** Модель `Payment` (поле `telegram_user_id`)
- **Когда:** При создании платежа через бота
- **Указано в политике:** ✅ Да (п. 2)
- **Срок хранения:** В течение срока действия договора + 3 года
- **Передача третьим лицам:** Нет

### 2. Telegram Username ⚠️
- **Где собирается:** Модель `Payment` (поле `telegram_username`)
- **Когда:** При создании платежа через бота (опционально)
- **Указано в политике:** ❌ НЕТ
- **Проблема:** Собирается, но не указано в политике конфиденциальности
- **Рекомендация:** Добавить в политику или перестать собирать

### 3. IP-адреса ✅
- **Где собирается:** 
  - Модель `TemporaryAccessToken` (поле `current_ip`) - при использовании токена
  - Модель `SubscriptionButtonClick` (поле `ip_address`) - при клике по кнопке подписки
- **Когда:** При каждом использовании токена и клике по кнопке подписки
- **Указано в политике:** ✅ Да (п. 2)
- **Срок хранения:** 1 год
- **Передача третьим лицам:** Нет (анонимизировано для аналитики)

### 4. История сессий (запросы/ответы) ✅
- **Где собирается:** Модель `Generation` (поля `topic`, `result`, `image_url`)
- **Когда:** При каждой генерации контента
- **Указано в политике:** ✅ Да (п. 2)
- **Срок хранения:** В течение срока действия подписки + 3 года после расторжения
- **Передача третьим лицам:** Нет

### 5. User-Agent ⚠️
- **Где собирается:** Модель `SubscriptionButtonClick` (поле `user_agent`)
- **Когда:** При клике по кнопке подписки
- **Указано в политике:** ❌ НЕТ
- **Проблема:** Собирается, но не указано в политике конфиденциальности
- **Рекомендация:** Добавить в политику или перестать собирать

### 6. Referer ⚠️
- **Где собирается:** Модель `SubscriptionButtonClick` (поле `referer`)
- **Когда:** При клике по кнопке подписки
- **Указано в политике:** ❌ НЕТ
- **Проблема:** Собирается, но не указано в политике конфиденциальности
- **Примечание:** Может считаться технической информацией, но для прозрачности лучше указать

### 7. Метрики использования ✅
- **Где собирается:** 
  - Модель `GigaChatTokenUsage` - статистика использования токенов
  - Модель `SubscriptionButtonClick` - статистика кликов
  - Модель `TemporaryAccessToken` - статистика использования токенов
- **Когда:** При каждом использовании сервиса
- **Указано в политике:** ✅ Да (п. 2)
- **Срок хранения:** Анонимно, бессрочно
- **Передача третьим лицам:** Нет

## Несоответствия

### Критичные:
1. **Telegram Username** - собирается, но не указано в политике
2. **User-Agent** - собирается, но не указано в политике
3. **Referer** - собирается, но не указано в политике

## Рекомендации

### Вариант 1: Добавить в политику конфиденциальности
Добавить в п. 2 политики конфиденциальности:
- Telegram Username (опционально, если предоставлен пользователем)
- User-Agent (техническая информация для безопасности)
- Referer (техническая информация для аналитики)

### Вариант 2: Перестать собирать
Удалить сбор этих данных из кода, если они не критичны для работы сервиса.

## Дополнительные замечания

1. **IP-адреса в TemporaryAccessToken** - обновляются при каждом использовании токена, что может создавать историю перемещений пользователя. Рекомендуется хранить только последний IP или анонимизировать старые записи.

2. **История сессий** - хранится полный текст запросов и ответов, что может содержать чувствительную информацию. Рекомендуется добавить возможность удаления пользователем.

3. **Метрики использования** - собираются анонимно, что соответствует политике.
