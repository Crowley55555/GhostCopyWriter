"""
Telegram –±–æ—Ç –¥–ª—è Ghostwriter

–ü—Ä–æ—Å—Ç–æ–π –±–æ—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ —Å–±–æ—Ä–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –ü–æ–ª–Ω–∞—è –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å - –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω, email, –∏–º—è
- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –∞–Ω–æ–Ω–∏–º–Ω–∞—è —Å–µ—Å—Å–∏—è
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –ª–∏—á–Ω–æ—Å—Ç–∏
- –ü—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å 3 –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ã–±–æ—Ä–∞ —Ç–∞—Ä–∏—Ñ–∞

–ù–∞—Å—Ç—Ä–æ–π–∫–∞:
1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —É @BotFather –∏ –ø–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook: python bot.py --set-webhook
3. –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤ polling —Ä–µ–∂–∏–º–µ: python bot.py

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
pip install python-telegram-bot requests python-dotenv
"""

import os
import sys
import json
import asyncio
import logging
import argparse
import requests
import uuid
from datetime import datetime, timedelta
from pathlib import Path
from decimal import Decimal
from dotenv import load_dotenv
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, MessageHandler, ContextTypes, filters

# –Æ–ö–∞—Å—Å–∞ SDK
try:
    from yookassa import Configuration, Payment as YooKassaPayment
    YOOKASSA_AVAILABLE = True
except ImportError:
    YOOKASSA_AVAILABLE = False
    logging.warning("yookassa SDK –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install yookassa")

# –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
BOT_TOKEN = os.getenv('TELEGRAM_BOT_TOKEN')
WEBHOOK_URL = os.getenv('TELEGRAM_WEBHOOK_URL')  # –ù–∞–ø—Ä–∏–º–µ—Ä: https://yourdomain.com/telegram/webhook/
WEBHOOK_SECRET = os.getenv('TELEGRAM_WEBHOOK_SECRET')
DJANGO_API_URL = os.getenv('DJANGO_API_URL', 'http://localhost:8000')  # URL Django —Å–µ—Ä–≤–µ—Ä–∞
DJANGO_API_KEY = os.getenv('DJANGO_API_KEY', '')  # API –∫–ª—é—á –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

# –†–µ–∫–≤–∏–∑–∏—Ç—ã –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (–¥–ª—è –æ—Ñ–µ—Ä—Ç—ã)
EXECUTOR_FULL_NAME = os.getenv('EXECUTOR_FULL_NAME', '–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ')
EXECUTOR_INN = os.getenv('EXECUTOR_INN', '')
EXECUTOR_PHONE = os.getenv('EXECUTOR_PHONE', '')
EXECUTOR_EMAIL = os.getenv('EXECUTOR_EMAIL', '')
EXECUTOR_TELEGRAM = os.getenv('EXECUTOR_TELEGRAM', '@username')
EXECUTOR_CITY = os.getenv('EXECUTOR_CITY', '–ú–æ—Å–∫–≤–∞, –†–æ—Å—Å–∏—è')

# –Æ–ö–∞—Å—Å–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
YOOKASSA_SHOP_ID = os.getenv('YOOKASSA_SHOP_ID', '')
YOOKASSA_SECRET_KEY = os.getenv('YOOKASSA_SECRET_KEY', '')

# –ì—Ä—É–ø–ø–∞ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –æ—Ç–∑—ã–≤–æ–≤ (—Å—Å—ã–ª–∫–∞-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∏–ª–∏ username –≥—Ä—É–ø–ø—ã)
SUPPORT_GROUP_URL = os.getenv('TELEGRAM_SUPPORT_GROUP_URL', '')  # https://t.me/ghostwriter_support –∏–ª–∏ invite link
REVIEWS_GROUP_URL = os.getenv('TELEGRAM_REVIEWS_GROUP_URL', '')  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∫–∞–Ω–∞–ª –æ—Ç–∑—ã–≤–æ–≤
TELEGRAM_ADMIN_IDS = [int(x) for x in os.getenv('TELEGRAM_ADMIN_IDS', '').split(',') if x.strip()]  # ID –∞–¥–º–∏–Ω–æ–≤ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Æ–ö–∞—Å—Å–∞
if YOOKASSA_AVAILABLE and YOOKASSA_SHOP_ID and YOOKASSA_SECRET_KEY:
    Configuration.account_id = YOOKASSA_SHOP_ID
    Configuration.secret_key = YOOKASSA_SECRET_KEY
    logger.info("–Æ–ö–∞—Å—Å–∞ SDK –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
elif YOOKASSA_AVAILABLE:
    logger.warning("–Æ–ö–∞—Å—Å–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã (YOOKASSA_SHOP_ID, YOOKASSA_SECRET_KEY)")

# –§–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∏–Ω—è—Ç—ã—Ö –æ—Ñ–µ—Ä—Ç
TERMS_ACCEPTED_FILE = Path('terms_accepted.json')

if not BOT_TOKEN:
    logger.error("‚ùå TELEGRAM_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ .env —Ñ–∞–π–ª–µ!")
    sys.exit(1)


def load_accepted_terms():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–∏–Ω—è–≤—à–∏—Ö –æ—Ñ–µ—Ä—Ç—É"""
    if TERMS_ACCEPTED_FILE.exists():
        try:
            with open(TERMS_ACCEPTED_FILE, 'r', encoding='utf-8') as f:
                return set(json.load(f))
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –ø—Ä–∏–Ω—è—Ç—ã—Ö –æ—Ñ–µ—Ä—Ç: {e}")
            return set()
    return set()


def save_accepted_terms(accepted_set):
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–∏–Ω—è–≤—à–∏—Ö –æ—Ñ–µ—Ä—Ç—É"""
    try:
        with open(TERMS_ACCEPTED_FILE, 'w', encoding='utf-8') as f:
            json.dump(list(accepted_set), f, ensure_ascii=False, indent=2)
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –ø—Ä–∏–Ω—è—Ç—ã—Ö –æ—Ñ–µ—Ä—Ç: {e}")


def has_accepted_terms(user_id):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø—Ä–∏–Ω—è–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ñ–µ—Ä—Ç—É"""
    accepted = load_accepted_terms()
    return user_id in accepted


def mark_terms_accepted(user_id):
    """–û—Ç–º–µ—á–∞–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω—è–ª –æ—Ñ–µ—Ä—Ç—É"""
    accepted = load_accepted_terms()
    accepted.add(user_id)
    save_accepted_terms(accepted)


def get_offer_text():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –ø—É–±–ª–∏—á–Ω–æ–π –æ—Ñ–µ—Ä—Ç—ã"""
    return f"""üìã <b>–ü–£–ë–õ–ò–ß–ù–ê–Ø –û–§–ï–†–¢–ê</b>

<b>1. –†–µ–∫–≤–∏–∑–∏—Ç—ã –∏ —Å—Ç–æ—Ä–æ–Ω—ã</b>
–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ <b>{EXECUTOR_FULL_NAME}</b>, —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã–π, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–º –∑–∞–∫–æ–Ω–æ–º ‚Ññ 422-–§–ó –æ—Ç 27.11.2018, –∏–º–µ–Ω—É–µ–º–æ–µ –¥–∞–ª–µ–µ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–º—É –∫—Ä—É–≥—É –ª–∏—Ü (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º) –∑–∞–∫–ª—é—á–∏—Ç—å –¥–æ–≥–æ–≤–æ—Ä –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö –Ω–∞—Å—Ç–æ—è—â–µ–π –ø—É–±–ª–∏—á–Ω–æ–π –æ—Ñ–µ—Ä—Ç—ã.

<b>2. –ü—Ä–µ–¥–º–µ—Ç –æ—Ñ–µ—Ä—Ç—ã</b>
2.1. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é GhostCopywriter ‚Äî —Å–µ—Ä–≤–∏—Å—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π.

2.2. –î–æ—Å—Ç—É–ø –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π:
‚Ä¢ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–ø–ª–∞—Ç—É –ø–æ–¥–ø–∏—Å–∫–∏;
‚Ä¢ –≤—ã–¥–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É –¥–æ—Å—Ç—É–ø–∞;
‚Ä¢ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç Telegram user ID –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –º—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç–æ–≤.

2.3. –¢–∞—Ä–∏—Ñ—ã:
‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å—Ç–∞—Ä—Ç: 30 000 —Ç–æ–∫–µ–Ω–æ–≤ GigaChat + 30 000 —Ç–æ–∫–µ–Ω–æ–≤ OpenAI (–±–µ—Å—Å—Ä–æ—á–Ω–æ, –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ)
‚Ä¢ –ë–∞–∑–æ–≤—ã–π: 200 000 —Ç–æ–∫–µ–Ω–æ–≤ GigaChat + 100 000 —Ç–æ–∫–µ–Ω–æ–≤ OpenAI (590 ‚ÇΩ/–º–µ—Å, –ø–æ–¥–ø–∏—Å–∫–∞)
‚Ä¢ –ü—Ä–æ: 500 000 —Ç–æ–∫–µ–Ω–æ–≤ GigaChat + 200 000 —Ç–æ–∫–µ–Ω–æ–≤ OpenAI (1 190 ‚ÇΩ/–º–µ—Å, –ø–æ–¥–ø–∏—Å–∫–∞)
‚Ä¢ –ë–µ–∑–ª–∏–º–∏—Ç: –±–µ–∑–ª–∏–º–∏—Ç GigaChat + 500 000 —Ç–æ–∫–µ–Ω–æ–≤ OpenAI (2 490 ‚ÇΩ/–º–µ—Å, –ø–æ–¥–ø–∏—Å–∫–∞)

2.4. –ò—Å—Ç–æ—Ä–∏—è —Å–µ—Å—Å–∏–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

<b>3. –ü–æ—Ä—è–¥–æ–∫ –∞–∫—Ü–µ–ø—Ç–∞ –∏ –æ–ø–ª–∞—Ç—ã</b>
3.1. –ê–∫—Ü–µ–ø—Ç–æ–º —Å—á–∏—Ç–∞–µ—Ç—Å—è:
‚Ä¢ —É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç;
‚Ä¢ –≤—Ö–æ–¥ –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ –ø–æ–ª—É—á–µ–Ω–Ω–æ–π —Å—Å—ã–ª–∫–µ.

3.2. –û–ø–ª–∞—Ç–∞ –±–µ–∑–Ω–∞–ª–∏—á–Ω–∞—è —á–µ—Ä–µ–∑ –ø–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (–ÆKassa, CloudPayments –∏ –¥—Ä.). –í–æ–∑–≤—Ä–∞—Ç ‚Äî –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π –ø–æ –ø–∏—Å—å–º–µ–Ω–Ω–æ–º—É —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é.

3.3. –ü–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ 7 –¥–Ω–µ–π –¥–æ —Å–ø–∏—Å–∞–Ω–∏—è.

<b>4. –ü—Ä–∞–≤–∞ –∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏</b>
<b>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ø—Ä–∞–≤–µ:</b>
‚Ä¢ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ —Å–≤–æ–∏—Ö —Å–æ—Ü—Å–µ—Ç—è—Ö;
‚Ä¢ –ø–æ–ª—É—á–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É —á–µ—Ä–µ–∑ –±–æ—Ç;
‚Ä¢ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∏—Å—Ç–æ—Ä–∏–∏ —Å–≤–æ–∏—Ö —Å–µ—Å—Å–∏–π.

<b>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∑–∞–ø—Ä–µ—â–µ–Ω–æ:</b>
‚Ä¢ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å/—Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥;
‚Ä¢ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ–º–æ/—Å–∫–∏–¥–æ–∫;
‚Ä¢ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º.

<b>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:</b> 100% uptime, —Ç–æ—á–Ω–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –±–∞–≥–æ–≤.

4.4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –û—Ç–∫–∞–∑–æ–º –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –Ω–µ–æ—Ç—ä–µ–º–ª–µ–º–æ–π —á–∞—Å—Ç—å—é –Ω–∞—Å—Ç–æ—è—â–µ–π –æ—Ñ–µ—Ä—Ç—ã.

<b>5. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç–æ—Ä–æ–Ω</b>
5.1. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è = —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ–ø–ª–∞—á–µ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏.
5.2. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏ —Å–æ—Ü—Å–µ—Ç–µ–π –∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É (–ø–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. –û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏).
5.3. –ù–∞—Ä—É—à–µ–Ω–∏–µ –∞–Ω—Ç–∏–º—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ = –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–µ–∑ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤.

<b>6. –†–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞</b>
6.1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –∫–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É" –≤ –±–æ—Ç–µ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è.
6.2. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –æ—Ñ–µ—Ä—Ç—ã –∏–ª–∏ –Ω–µ—É–ø–ª–∞—Ç–µ.
6.3. –°–ø–æ—Ä—ã ‚Äî —Å—É–¥ –ø–æ –º–µ—Å—Ç—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è ({EXECUTOR_CITY}).

<b>–†–µ–∫–≤–∏–∑–∏—Ç—ã:</b>
–§–ò–û: {EXECUTOR_FULL_NAME}
–ò–ù–ù: {EXECUTOR_INN}
–¢–µ–ª–µ—Ñ–æ–Ω: {EXECUTOR_PHONE}
Email: {EXECUTOR_EMAIL}
Telegram: {EXECUTOR_TELEGRAM}

<b>–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</b> 25 —è–Ω–≤–∞—Ä—è 2026 –≥.

<b>‚ö†Ô∏è –í–ê–ñ–ù–û:</b> –û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –¥–æ–ø–æ–ª–Ω—è–µ—Ç –Ω–∞—Å—Ç–æ—è—â—É—é –æ—Ñ–µ—Ä—Ç—É –∏ —è–≤–ª—è–µ—Ç—Å—è –µ—ë –Ω–µ–æ—Ç—ä–µ–º–ª–µ–º–æ–π —á–∞—Å—Ç—å—é."""


def get_privacy_policy_text():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏"""
    return f"""üîí <b>–ü–û–õ–ò–¢–ò–ö–ê –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–ò</b>

<b>1. –°—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –ü–î–Ω</b>
–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–µ—Å—Ç—Ä–µ –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä–∞. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —è–≤–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

<b>2. –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è</b>
‚Ä¢ <b>Telegram user ID</b> ‚Äî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –∑–∞—â–∏—Ç–∞ –æ—Ç –º—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç–æ–≤, rate-limit
  –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: –í —Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞ + 3 –≥–æ–¥–∞
  –ü–µ—Ä–µ–¥–∞—á–∞ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º: –ù–µ—Ç

‚Ä¢ <b>Telegram username</b> (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ
  –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: –í —Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞ + 3 –≥–æ–¥–∞
  –ü–µ—Ä–µ–¥–∞—á–∞ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º: –ù–µ—Ç

‚Ä¢ <b>–ò—Å—Ç–æ—Ä–∏—è —Å–µ—Å—Å–∏–π</b> (–∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã) ‚Äî –§—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞
  –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: –í —Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ + 3 –≥–æ–¥–∞ –ø–æ—Å–ª–µ —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏—è
  –ü–µ—Ä–µ–¥–∞—á–∞ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º: –ù–µ—Ç

‚Ä¢ <b>IP-–∞–¥—Ä–µ—Å–∞</b> ‚Äî –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
  –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 1 –≥–æ–¥
  –ü–µ—Ä–µ–¥–∞—á–∞ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º: –ù–µ—Ç (–∞–Ω–æ–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)

‚Ä¢ <b>User-Agent –∏ Referer</b> ‚Äî –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
  –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 1 –≥–æ–¥
  –ü–µ—Ä–µ–¥–∞—á–∞ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º: –ù–µ—Ç (–∞–Ω–æ–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)

‚Ä¢ <b>–ú–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</b> ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
  –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: –ê–Ω–æ–Ω–∏–º–Ω–æ, –±–µ—Å—Å—Ä–æ—á–Ω–æ
  –ü–µ—Ä–µ–¥–∞—á–∞ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º: –ù–µ—Ç

<b>3. –ü—Ä–∞–≤–æ–≤–∞—è –æ—Å–Ω–æ–≤–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏</b>
‚Ä¢ –°–æ–≥–ª–∞—Å–∏–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—Ç. 9 152-–§–ó);
‚Ä¢ –î–æ–≥–æ–≤–æ—Ä–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è (—Å—Ç. 6 152-–§–ó).

–°–æ–≥–ª–∞—Å–∏–µ –¥–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–æ–π "–ü—Ä–∏–Ω—è—Ç—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã" –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –±–æ—Ç–æ–º.

<b>4. –ü—Ä–∞–≤–∞ —Å—É–±—ä–µ–∫—Ç–∞ –ü–î–Ω</b>
‚Ä¢ –æ—Ç–æ–∑–≤–∞—Ç—å —Å–æ–≥–ª–∞—Å–∏–µ (–æ—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏);
‚Ä¢ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–ø–∏—Å—å–º–µ–Ω–Ω–æ –Ω–∞ email);
‚Ä¢ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π (–ø–æ –∑–∞–ø—Ä–æ—Å—É);
‚Ä¢ –ø–æ–ª—É—á–∏—Ç—å –≤—ã–ø–∏—Å–∫—É –∏—Å—Ç–æ—Ä–∏–∏ —Å–µ—Å—Å–∏–π.

<b>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</b> –û—Ç–∑—ã–≤ —Å–æ–≥–ª–∞—Å–∏—è = –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å—É.

<b>5. –ú–µ—Ä—ã –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö (–£–ó-1)</b>
‚Ä¢ HTTPS everywhere;
‚Ä¢ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ë–î (at-rest);
‚Ä¢ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ (—Ä–æ–ª–∏);
‚Ä¢ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ);
‚Ä¢ –ê—É–¥–∏—Ç –ª–æ–≥–æ–≤ –¥–æ—Å—Ç—É–ø–∞.

<b>6. –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏</b>
–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ –±–æ—Ç–µ –∏ –Ω–∞ —Å–∞–π—Ç–µ –∑–∞ 10 –¥–Ω–µ–π –¥–æ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —Å–∏–ª—É. –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è = —Å–æ–≥–ª–∞—Å–∏–µ.

<b>–î–∞—Ç–∞:</b> 25 —è–Ω–≤–∞—Ä—è 2026 –≥.
<b>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</b> {EXECUTOR_EMAIL}, {EXECUTOR_TELEGRAM}

<b>‚ö†Ô∏è –í–ê–ñ–ù–û:</b> –û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –¥–æ–ø–æ–ª–Ω—è–µ—Ç –Ω–∞—Å—Ç–æ—è—â—É—é –ø–æ–ª–∏—Ç–∏–∫—É –∏ —è–≤–ª—è–µ—Ç—Å—è –µ—ë –Ω–µ–æ—Ç—ä–µ–º–ª–µ–º–æ–π —á–∞—Å—Ç—å—é."""


def get_consent_text():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ü–î–Ω (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è —Å–æ –≤—Å–µ–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏)"""
    return f"""‚úÖ <b>–°–û–ì–õ–ê–°–ò–ï –ù–ê –û–ë–†–ê–ë–û–¢–ö–£ –ü–ï–†–°–û–ù–ê–õ–¨–ù–´–• –î–ê–ù–ù–´–• –ò –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –û–ó–ù–ê–ö–û–ú–õ–ï–ù–ò–Ø</b>

–ù–∞—Å—Ç–æ—è—â–∏–º, –¥–µ–π—Å—Ç–≤—É—è —Å–≤–æ–µ–π –≤–æ–ª–µ–π –∏ –≤ —Å–≤–æ–µ–º –∏–Ω—Ç–µ—Ä–µ—Å–µ, —è, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–µ—Ä–≤–∏—Å–∞ GhostCopywriter:

<b>1. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏–µ:</b>
‚Ä¢ —Å –ü—É–±–ª–∏—á–Ω–æ–π –æ—Ñ–µ—Ä—Ç–æ–π;
‚Ä¢ —Å –ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏;
‚Ä¢ —Å –û—Ç–∫–∞–∑–æ–º –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.

<b>2. –î–∞—é —Å–æ–≥–ª–∞—Å–∏–µ</b> —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º—É –ª–∏—Ü—É <b>{EXECUTOR_FULL_NAME}</b>, —Å–∞–º–æ–∑–∞–Ω—è—Ç–æ–º—É, –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –º–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
‚Ä¢ Telegram user ID;
‚Ä¢ Telegram username (–µ—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω);
‚Ä¢ IP-–∞–¥—Ä–µ—Å–∞;
‚Ä¢ User-Agent –∏ Referer (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è);
‚Ä¢ –∏—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Å —Å–µ—Ä–≤–∏—Å–æ–º (–∑–∞–ø—Ä–æ—Å—ã, –æ—Ç–≤–µ—Ç—ã, –º–µ—Ç—Ä–∏–∫–∏).

<b>3. –¶–µ–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:</b>
‚Ä¢ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–ª–∞—Ç–Ω–æ–º—É —Å–µ—Ä–≤–∏—Å—É;
‚Ä¢ –∑–∞—â–∏—Ç–∞ –æ—Ç –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞ –∏ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π;
‚Ä¢ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —É–ª—É—á—à–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞;
‚Ä¢ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

<b>4. –°–æ–≥–ª–∞—Å–µ–Ω –Ω–∞:</b> —Å–±–æ—Ä, –∑–∞–ø–∏—Å—å, —Å–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏—é, —Ö—Ä–∞–Ω–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –æ–±–µ–∑–ª–∏—á–∏–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.

<b>5. –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–æ–≥–ª–∞—Å–∏—è:</b> –≤ —Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞ + 3 –≥–æ–¥–∞ –ø–æ—Å–ª–µ —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏—è.

<b>6. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é:</b> –≤–ø—Ä–∞–≤–µ –æ—Ç–æ–∑–≤–∞—Ç—å —Å–æ–≥–ª–∞—Å–∏–µ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è.

<b>7. –ü–æ–Ω–∏–º–∞—é –∏ –ø—Ä–∏–Ω–∏–º–∞—é:</b> —á—Ç–æ –Ω–µ—Å—É –ø–æ–ª–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –û—Ç–∫–∞–∑–æ–º –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏."""


def get_disclaimer_text():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –æ—Ç–∫–∞–∑–∞ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏"""
    return """‚ö†Ô∏è <b>–û–¢–ö–ê–ó –û–¢ –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–ò</b>

–û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ GhostCopywriter –¥–æ–ø–æ–ª–Ω—è–µ—Ç –ü—É–±–ª–∏—á–Ω—É—é –æ—Ñ–µ—Ä—Ç—É –∏ –ü–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –Ω–µ—Å–µ—Ç –≤—Å–µ —Ä–∏—Å–∫–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

<b>1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–π –∫–∞—á–µ—Å—Ç–≤–∞</b>
1.1. –°–µ—Ä–≤–∏—Å GhostCopywriter –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π –±–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏, –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –∏–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ñ–∞–∫—Ç–∞–º.
1.2. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç.
1.3. –í–æ–∑–º–æ–∂–Ω—ã –æ—à–∏–±–∫–∏, –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏, –Ω–µ—É–º–µ—Å—Ç–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏, –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å—Ç–∏–ª—è –∏–ª–∏ –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–∞–≤.

<b>2. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—é</b>
2.1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –Ω–µ—Å–µ—Ç 100% –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞:
‚Ä¢ –ø—Ä–∞–≤–¥–∏–≤–æ—Å—Ç—å –∏ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞;
‚Ä¢ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ (—Ä–µ–∫–ª–∞–º–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞, –∞–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞, —Ç–æ–≤–∞—Ä–Ω—ã–µ –∑–Ω–∞–∫–∏);
‚Ä¢ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (—ç–∫—Å—Ç—Ä–µ–º–∏–∑–º, –Ω–∞—Å–∏–ª–∏–µ, –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏—è);
‚Ä¢ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤, —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤).

2.2. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –ª—é–±—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, –≤–∫–ª—é—á–∞—è:
‚Ä¢ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —É–±—ã—Ç–∫–∏ –æ—Ç —à—Ç—Ä–∞—Ñ–æ–≤ –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫;
‚Ä¢ —Ä–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏;
‚Ä¢ —Å—É–¥–µ–±–Ω—ã–µ –∏—Å–∫–∏ –æ—Ç —Ç—Ä–µ—Ç—å–∏—Ö –ª–∏—Ü.

<b>3. –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π</b>
3.1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:
‚Ä¢ –ü—Ä–∞–≤–∏–ª–∞–º Instagram, VK, Facebook, TikTok, YouTube –∏ –¥—Ä—É–≥–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º;
‚Ä¢ –†–µ–∫–ª–∞–º–Ω–æ–º—É –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É –†–§ (‚Ññ 38-–§–ó);
‚Ä¢ –ó–∞–∫–æ–Ω—É –æ —Ä–µ–∫–ª–∞–º–µ –∏ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–µ (–µ–¥–∏–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –†–ö–ù).

3.2. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –¥–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—é —Ä–µ–∫–ª–∞–º—ã –∏ –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏—è.

<b>4. –ê–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞ –∏ –ø–ª–∞–≥–∏–∞—Ç</b>
4.1. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —á—É–∂–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤ –∏–∑ –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ò–ò.
4.2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—è–∑–∞–Ω —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å—ã (Text.ru, Advego, Copyleaks).
4.3. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç 100% –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏ –ø—Ä–∞–≤–æ–æ–±–ª–∞–¥–∞—Ç–µ–ª–µ–π.

<b>5. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</b>
5.1. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è = —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ–ø–ª–∞—á–µ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏.
5.2. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∫–æ—Å–≤–µ–Ω–Ω—ã–µ —É–±—ã—Ç–∫–∏, —É–ø—É—â–µ–Ω–Ω—É—é –≤—ã–≥–æ–¥—É, –º–æ—Ä–∞–ª—å–Ω—ã–π –≤—Ä–µ–¥.
5.3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ –ø–æ–Ω–∏–º–∞–µ—Ç —Ä–∏—Å–∫–∏ –ò–ò-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏—Ö –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ.

<b>6. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã)</b>
‚Ä¢ –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ñ–∞–∫—Ç—ã –∏ —Ü–∏—Ñ—Ä—ã –≤—Ä—É—á–Ω—É—é;
‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª–∏–∑–∞—Ç–æ—Ä—ã —Ç–µ–∫—Å—Ç–∞;
‚Ä¢ –°–æ–±–ª—é–¥–∞—Ç—å –ª–∏–º–∏—Ç—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º –ø–æ –∞–≤—Ç–æ–ø–æ—Å—Ç–∏–Ω–≥—É;
‚Ä¢ –ú–∞—Ä–∫–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∫–ª–∞–º—É (#—Ä–µ–∫–ª–∞–º–∞, #–ø—Ä–æ–¥–∞–∂–∞);
‚Ä¢ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ –Ω–µ–±–æ–ª—å—à–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏.

<b>–î–∞—Ç–∞:</b> 25 —è–Ω–≤–∞—Ä—è 2026 –≥."""


async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
    
    –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ñ–µ—Ä—Ç—É, –∑–∞—Ç–µ–º –º–µ–Ω—é —Å —Ç–∞—Ä–∏—Ñ–∞–º–∏.
    """
    user = update.effective_user
    
    if not update.message:
        logger.error("update.message is None in start_command")
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∏–Ω—è–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ñ–µ—Ä—Ç—É
    if not has_accepted_terms(user.id):
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ñ–µ—Ä—Ç—É –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
        logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user.id} –µ—â–µ –Ω–µ –ø—Ä–∏–Ω—è–ª –¥–æ–∫—É–º–µ–Ω—Ç—ã, –ø–æ–∫–∞–∑—ã–≤–∞—é –æ—Ñ–µ—Ä—Ç—É")
        await show_offer(update, context)
        return
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user.id} —É–∂–µ –ø—Ä–∏–Ω—è–ª –¥–æ–∫—É–º–µ–Ω—Ç—ã, –ø–æ–∫–∞–∑—ã–≤–∞—é –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")
    await show_main_menu(update, context)


async def show_offer(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã: –æ—Ñ–µ—Ä—Ç—É, –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏, –æ—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Å–æ–≥–ª–∞—Å–∏–µ"""
    user = update.effective_user
    
    if not update.message:
        logger.error("update.message is None in show_offer")
        return
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º
    welcome_text = (
        "‚ö†Ô∏è <b>–í–ê–ñ–ù–û: –í—ã –Ω–µ—Å–µ—Ç–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç</b>\n\n"
        "–ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–µ—Ä–≤–∏—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å–æ –≤—Å–µ–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏:\n"
        "‚Ä¢ –ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞\n"
        "‚Ä¢ –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏\n"
        "‚Ä¢ –û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏\n"
        "‚Ä¢ –°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö\n\n"
        "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–∏–∂–µ."
    )
    await update.message.reply_html(welcome_text)
    await asyncio.sleep(1)
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ñ–µ—Ä—Ç—É
    offer_text = get_offer_text()
    await update.message.reply_html(offer_text)
    await asyncio.sleep(1)
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
    privacy_text = get_privacy_policy_text()
    await update.message.reply_html(privacy_text)
    await asyncio.sleep(1)
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
    disclaimer_text = get_disclaimer_text()
    await update.message.reply_html(disclaimer_text)
    await asyncio.sleep(1)
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ü–î–Ω —Å –∫–Ω–æ–ø–∫–∞–º–∏
    consent_text = get_consent_text()
    keyboard = [
        [InlineKeyboardButton("‚úÖ –ü—Ä–∏–Ω—è—Ç—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã", callback_data='accept_all_documents')],
        [InlineKeyboardButton("‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å", callback_data='reject_terms')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await update.message.reply_html(
        consent_text,
        reply_markup=reply_markup
    )
    
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user.id} –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã")


def _get_main_menu_keyboard():
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é: –¢–∞—Ä–∏—Ñ—ã, –ú–æ–∏ —Ç–æ–∫–µ–Ω—ã, –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞, –û—Ç–∑—ã–≤"""
    keyboard = [
        [InlineKeyboardButton("üí≥ –¢–∞—Ä–∏—Ñ—ã –∏ –æ–ø–ª–∞—Ç–∞", callback_data='menu_tariffs')],
        [InlineKeyboardButton("üé´ –ú–æ–∏ —Ç–æ–∫–µ–Ω—ã", callback_data='menu_my_tokens')],
    ]
    if SUPPORT_GROUP_URL:
        keyboard.append([InlineKeyboardButton("üí¨ –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞", url=SUPPORT_GROUP_URL)])
    else:
        keyboard.append([InlineKeyboardButton("üí¨ –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞", callback_data='menu_support_placeholder')])
    keyboard.append([InlineKeyboardButton("‚≠ê –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤", callback_data='menu_review')])
    return InlineKeyboardMarkup(keyboard)


async def show_main_menu(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é: –¢–∞—Ä–∏—Ñ—ã, –ú–æ–∏ —Ç–æ–∫–µ–Ω—ã, –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞, –û—Ç–∑—ã–≤"""
    message = update.message
    if not message and update.callback_query:
        message = update.callback_query.message
    if not message:
        logger.error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å message –≤ show_main_menu")
        return
    text = (
        "üëã <b>Ghostwriter</b> ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π.\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:"
    )
    try:
        if update.callback_query:
            await update.callback_query.edit_message_text(
                text=text,
                parse_mode='HTML',
                reply_markup=_get_main_menu_keyboard()
            )
        else:
            await message.reply_html(text, reply_markup=_get_main_menu_keyboard())
    except Exception as e:
        logger.warning(f"edit_message_text failed (maybe same content): {e}")
        await message.reply_html(text, reply_markup=_get_main_menu_keyboard())


async def show_tariff_menu(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é —Å —Ç–∞—Ä–∏—Ñ–∞–º–∏"""
    message = update.message
    if not message and update.callback_query:
        message = update.callback_query.message
    if not message:
        logger.error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å message –∏–∑ update –≤ show_tariff_menu")
        return
    keyboard = [
        [InlineKeyboardButton("üÜì –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å—Ç–∞—Ä—Ç", callback_data='demo_free')],
        [InlineKeyboardButton("üìä –ë–∞–∑–æ–≤—ã–π - 590‚ÇΩ/–º–µ—Å", callback_data='buy_basic')],
        [InlineKeyboardButton("‚≠ê –ü—Ä–æ - 1190‚ÇΩ/–º–µ—Å", callback_data='buy_pro')],
        [InlineKeyboardButton("üöÄ –ë–µ–∑–ª–∏–º–∏—Ç - 2490‚ÇΩ/–º–µ—Å", callback_data='buy_unlimited')],
        [InlineKeyboardButton("¬´ –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é", callback_data='back_to_menu')],
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    welcome_text = (
        "üí≥ <b>–¢–∞—Ä–∏—Ñ—ã –∏ –æ–ø–ª–∞—Ç–∞</b>\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞:\n\n"
        "üÜì <b>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å—Ç–∞—Ä—Ç</b> ‚Äî 30 000 GigaChat + 30 000 OpenAI, –±–µ—Å—Å—Ä–æ—á–Ω–æ\n"
        "üìä <b>–ë–∞–∑–æ–≤—ã–π</b> ‚Äî 590‚ÇΩ/–º–µ—Å\n"
        "‚≠ê <b>–ü—Ä–æ</b> ‚Äî 1 190‚ÇΩ/–º–µ—Å\n"
        "üöÄ <b>–ë–µ–∑–ª–∏–º–∏—Ç</b> ‚Äî 2 490‚ÇΩ/–º–µ—Å\n\n"
        "üîí <i>–ü–æ–ª–Ω–∞—è –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å.</i>"
    )
    try:
        if update.callback_query:
            await update.callback_query.edit_message_text(
                text=welcome_text,
                parse_mode='HTML',
                reply_markup=reply_markup
            )
        else:
            await message.reply_html(welcome_text, reply_markup=reply_markup)
    except Exception as e:
        await message.reply_html(welcome_text, reply_markup=reply_markup)


async def process_demo_token(query, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ (—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)"""
    user = query.from_user
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    await query.edit_message_text(
        text="‚è≥ <b>–ì–µ–Ω–µ—Ä–∏—Ä—É—é —Ç–æ–∫–µ–Ω...</b>\n\n"
             "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.",
        parse_mode='HTML'
    )
    
    # –°–æ–∑–¥–∞–µ–º —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ Django API —Å –ø–µ—Ä–µ–¥–∞—á–µ–π user_id
    token_data = create_token_via_api('DEMO_FREE', telegram_user_id=user.id)
    
    if token_data:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤–µ—Ä–Ω—É–ª–∞—Å—å –ª–∏ –æ—à–∏–±–∫–∞ –æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Ç–æ–∫–µ–Ω–µ
        if 'error' in token_data:
            if token_data.get('error') == 'Demo token already exists':
                existing_url = token_data.get('existing_token_url', '')
                existing_text = (
                    "‚ö†Ô∏è <b>–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω!</b>\n\n"
                    "–û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω.\n\n"
                    f"üîó <b>–í–∞—à–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å—Å—ã–ª–∫–∞:</b>\n{existing_url}\n\n"
                    "üí° <i>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å—É.</i>"
                )
                await query.edit_message_text(
                    text=existing_text,
                    parse_mode='HTML'
                )
                return
            elif token_data.get('error') == 'Active subscription exists':
                existing_url = token_data.get('existing_token_url', '')
                sub_type = token_data.get('subscription_type', '')
                next_renewal = token_data.get('next_renewal', '')
                existing_text = (
                    f"‚ö†Ô∏è <b>–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞!</b>\n\n"
                    f"–¢–∞—Ä–∏—Ñ: <b>{sub_type}</b>\n"
                    f"–°–ª–µ–¥—É—é—â–µ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: {next_renewal}\n\n"
                    f"üîó <b>–í–∞—à–∞ —Å—Å—ã–ª–∫–∞:</b>\n{existing_url}\n\n"
                    "üí° <i>–î–æ–∂–¥–∏—Ç–µ—Å—å –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç–µ–∫—É—â–µ–π –ø–æ–¥–ø–∏—Å–∫–∏ –∏–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç–µ –µ—ë.</i>"
                )
                await query.edit_message_text(
                    text=existing_text,
                    parse_mode='HTML'
                )
                return
        
        # –£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–ª–∏ —Ç–æ–∫–µ–Ω
        token = token_data.get('token')
        expires_at = token_data.get('expires_at')
        token_url = token_data.get('url')
        
        # –ü–∞—Ä—Å–∏–º –¥–∞—Ç—É –∏—Å—Ç–µ—á–µ–Ω–∏—è
        try:
            if expires_at:
                expires_dt = datetime.fromisoformat(expires_at.replace('Z', '+00:00'))
                expires_str = expires_dt.strftime('%d.%m.%Y %H:%M')
            else:
                expires_str = "–±–µ—Å—Å—Ä–æ—á–Ω–æ"
        except:
            expires_str = expires_at if expires_at else "–±–µ—Å—Å—Ä–æ—á–Ω–æ"
        
        demo_text = (
            "‚úÖ <b>DEMO —Ç–æ–∫–µ–Ω –≥–æ—Ç–æ–≤!</b>\n\n"
            "üìù <b>–£—Å–ª–æ–≤–∏—è:</b>\n"
            "‚Ä¢ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: –±–µ—Å—Å—Ä–æ—á–Ω–æ\n"
            "‚Ä¢ 30 000 —Ç–æ–∫–µ–Ω–æ–≤ GigaChat + 30 000 OpenAI\n\n"
            "üîó <b>–í–∞—à–∞ —Å—Å—ã–ª–∫–∞:</b>\n"
            f"{token_url}\n\n"
            f"üìÖ <b>–ê–∫—Ç–∏–≤–Ω–∞ –¥–æ:</b> {expires_str}\n\n"
            "üìå <i>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</i>\n\n"
            "üí° <b>–°–æ–≤–µ—Ç:</b> –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É - –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ª–æ–≥–∏–Ω!"
        )
        
        await query.edit_message_text(
            text=demo_text,
            parse_mode='HTML'
        )
    else:
        # –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
        error_text = (
            "‚ùå <b>–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞</b>\n\n"
            "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å DEMO —Ç–æ–∫–µ–Ω. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n"
            "‚Ä¢ Django —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω\n"
            "‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º\n\n"
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É."
        )
        
        await query.edit_message_text(
            text=error_text,
            parse_mode='HTML'
        )




def create_token_via_api(token_type, telegram_user_id=None):
    """
    –°–æ–∑–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ Django API
    
    Args:
        token_type: –¢–∏–ø —Ç–æ–∫–µ–Ω–∞ ('DEMO_FREE', 'BASIC', 'PRO', 'UNLIMITED')
        telegram_user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –º—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç–æ–≤)
    
    Returns:
        dict: –î–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω–∞ –∏–ª–∏ None –ø—Ä–∏ –æ—à–∏–±–∫–µ
    """
    try:
        url = f"{DJANGO_API_URL}/api/tokens/create/"
        headers = {}
        if DJANGO_API_KEY:
            headers['X-API-Key'] = DJANGO_API_KEY
        data = {'token_type': token_type}
        if telegram_user_id is not None:
            data['telegram_user_id'] = telegram_user_id
        
        logger.info(f"–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ Django API: {url}, —Ç–∏–ø: {token_type}")
        response = requests.post(url, json=data, headers=headers, timeout=10)
        
        if response.status_code == 201:
            result = response.json()
            logger.info(f"‚úÖ –¢–æ–∫–µ–Ω —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ: {result.get('token')}")
            return result
        else:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: {response.status_code} - {response.text}")
            return None
            
    except requests.RequestException as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Django API: {e}")
        return None
    except Exception as e:
        logger.error(f"‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞: {e}")
        return None


def create_yookassa_payment(user_id: int, username: str = None, tariff_type: str = 'BASIC', price: float = 590.0):
    """
    –°–æ–∑–¥–∞—ë—Ç –ø–ª–∞—Ç—ë–∂ –≤ –Æ–ö–∞—Å—Å–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏
    
    Args:
        user_id: Telegram user ID
        username: Telegram username (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        tariff_type: –¢–∏–ø —Ç–∞—Ä–∏—Ñ–∞ ('BASIC', 'PRO', 'UNLIMITED')
        price: –¶–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ —Ä—É–±–ª—è—Ö
    
    Returns:
        dict: –î–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∞ (id, confirmation_url) –∏–ª–∏ None –ø—Ä–∏ –æ—à–∏–±–∫–µ
    """
    if not YOOKASSA_AVAILABLE:
        logger.error("‚ùå yookassa SDK –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        return None
    
    if not YOOKASSA_SHOP_ID or not YOOKASSA_SECRET_KEY:
        logger.error("‚ùå –Æ–ö–∞—Å—Å–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã")
        return None
    
    try:
        # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π idempotency_key –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
        idempotency_key = str(uuid.uuid4())
        
        # –ù–∞–∑–≤–∞–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤
        tariff_names = {
            'BASIC': '–ë–∞–∑–æ–≤—ã–π',
            'PRO': '–ü—Ä–æ',
            'UNLIMITED': '–ë–µ–∑–ª–∏–º–∏—Ç'
        }
        tariff_name = tariff_names.get(tariff_type, tariff_type)
        
        # –°–æ–∑–¥–∞—ë–º –ø–ª–∞—Ç—ë–∂ –≤ –Æ–ö–∞—Å—Å–∞
        payment = YooKassaPayment.create({
            "amount": {
                "value": str(price),
                "currency": "RUB"
            },
            "confirmation": {
                "type": "redirect",
                "return_url": f"https://t.me/{os.getenv('BOT_USERNAME', 'ghostwriter_bot')}?start=check_payment"
            },
            "capture": True,
            "description": f"GhostCopywriter - –ø–æ–¥–ø–∏—Å–∫–∞ {tariff_name}",
            "metadata": {
                "telegram_user_id": user_id,
                "telegram_username": username or "",
                "tariff": tariff_type,
                "days": 30
            }
        }, idempotency_key)
        
        logger.info(f"‚úÖ –ü–ª–∞—Ç—ë–∂ –Æ–ö–∞—Å—Å–∞ —Å–æ–∑–¥–∞–Ω: {payment.id}")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–ª–∞—Ç—ë–∂ –≤ Django
        save_payment_to_django(
            payment_id=payment.id,
            user_id=user_id,
            username=username,
            amount=float(price),
            payment_url=payment.confirmation.confirmation_url,
            tariff_type=tariff_type
        )
        
        return {
            'id': payment.id,
            'confirmation_url': payment.confirmation.confirmation_url,
            'status': payment.status,
            'tariff_type': tariff_type
        }
        
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ –Æ–ö–∞—Å—Å–∞: {e}")
        return None


def save_review_via_api(telegram_user_id: int, telegram_username: str, text: str, rating: int = None):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–∑—ã–≤ –≤ Django API. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç dict —Å id/status –∏–ª–∏ None."""
    try:
        url = f"{DJANGO_API_URL}/api/reviews/create/"
        headers = {}
        if DJANGO_API_KEY:
            headers['X-API-Key'] = DJANGO_API_KEY
        data = {
            'telegram_user_id': telegram_user_id,
            'telegram_username': telegram_username or '',
            'text': text,
        }
        if rating is not None:
            data['rating'] = rating
        response = requests.post(url, json=data, headers=headers, timeout=10)
        if response.status_code == 201:
            return response.json()
        logger.warning(f"API reviews/create: {response.status_code} {response.text}")
        return None
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞ –≤ Django: {e}")
        return None


def save_support_ticket_via_api(telegram_user_id: int, telegram_username: str, message: str, subject: str = '', source: str = 'bot'):
    """–°–æ–∑–¥–∞—ë—Ç —Ç–∏–∫–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —á–µ—Ä–µ–∑ Django API."""
    try:
        url = f"{DJANGO_API_URL}/api/support/create/"
        headers = {}
        if DJANGO_API_KEY:
            headers['X-API-Key'] = DJANGO_API_KEY
        data = {
            'telegram_user_id': telegram_user_id,
            'telegram_username': telegram_username or '',
            'message': message,
            'subject': subject,
            'source': source,
        }
        response = requests.post(url, json=data, headers=headers, timeout=10)
        if response.status_code == 201:
            return response.json()
        return None
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–∞: {e}")
        return None


def save_payment_to_django(payment_id: str, user_id: int, username: str, amount: float, payment_url: str, tariff_type: str = 'BASIC'):
    """
    –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–ª–∞—Ç—ë–∂ –≤ Django —á–µ—Ä–µ–∑ API
    
    Args:
        payment_id: ID –ø–ª–∞—Ç–µ–∂–∞ –Æ–ö–∞—Å—Å–∞
        user_id: Telegram user ID
        username: Telegram username
        amount: –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞
        payment_url: –°—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É
        tariff_type: –¢–∏–ø —Ç–∞—Ä–∏—Ñ–∞
    """
    try:
        url = f"{DJANGO_API_URL}/api/payments/create/"
        
        headers = {}
        if DJANGO_API_KEY:
            headers['X-API-Key'] = DJANGO_API_KEY
        
        tariff_names = {
            'BASIC': '–ë–∞–∑–æ–≤—ã–π (590‚ÇΩ/–º–µ—Å)',
            'PRO': '–ü—Ä–æ (1190‚ÇΩ/–º–µ—Å)',
            'UNLIMITED': '–ë–µ–∑–ª–∏–º–∏—Ç (2490‚ÇΩ/–º–µ—Å)'
        }
        description = f"{tariff_names.get(tariff_type, tariff_type)} - –ø–æ–¥–ø–∏—Å–∫–∞ GhostCopywriter"
        
        data = {
            'external_id': payment_id,
            'telegram_user_id': user_id,
            'telegram_username': username or '',
            'amount': amount,
            'payment_system': 'yookassa',
            'description': description,
            'payment_url': payment_url
        }
        
        response = requests.post(url, json=data, headers=headers, timeout=10)
        
        if response.status_code in [200, 201]:
            logger.info(f"‚úÖ –ü–ª–∞—Ç—ë–∂ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ Django: {payment_id}")
        else:
            logger.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–ª–∞—Ç—ë–∂ –≤ Django: {response.status_code}")
            
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ –≤ Django: {e}")


async def handle_payment(query, context, tariff_type: str, price: float):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –¥–ª—è —Ç–∞—Ä–∏—Ñ–∞
    
    Args:
        query: CallbackQuery –æ—Ç Telegram
        context: Context –±–æ—Ç–∞
        tariff_type: –¢–∏–ø —Ç–∞—Ä–∏—Ñ–∞ ('BASIC', 'PRO', 'UNLIMITED')
        price: –¶–µ–Ω–∞ —Ç–∞—Ä–∏—Ñ–∞
    """
    user = query.from_user
    
    await query.edit_message_text(
        text="‚è≥ <b>–°–æ–∑–¥–∞—é –ø–ª–∞—Ç—ë–∂...</b>\n\n"
             "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.",
        parse_mode='HTML'
    )
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ª–∏ –Æ–ö–∞—Å—Å–∞
    if not YOOKASSA_SHOP_ID or not YOOKASSA_SECRET_KEY:
        await query.edit_message_text(
            text="‚ö†Ô∏è <b>–ü–ª–∞—Ç—ë–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ</b>\n\n"
                 "–ü–ª–∞—Ç–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã —Å–∫–æ—Ä–æ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã.\n\n"
                 "–ü–æ–∫–∞ –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º —Ç–∞—Ä–∏—Ñ–æ–º.",
            parse_mode='HTML'
        )
        return
    
    # –°–æ–∑–¥–∞—ë–º –ø–ª–∞—Ç—ë–∂
    payment = create_yookassa_payment(user.id, user.username, tariff_type, price)
    
    if payment:
        # –£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–ª–∏ –ø–ª–∞—Ç—ë–∂
        payment_url = payment.get('confirmation_url')
        payment_id = payment.get('id')
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –ø–ª–∞—Ç–µ–∂–∞ –∏ —Ç–∏–ø —Ç–∞—Ä–∏—Ñ–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
        if not context.user_data:
            context.user_data = {}
        context.user_data['pending_payment_id'] = payment_id
        context.user_data['tariff_type'] = tariff_type
        
        tariff_names = {
            'BASIC': '–ë–∞–∑–æ–≤—ã–π',
            'PRO': '–ü—Ä–æ',
            'UNLIMITED': '–ë–µ–∑–ª–∏–º–∏—Ç'
        }
        tariff_name = tariff_names.get(tariff_type, tariff_type)
        
        keyboard = [
            [InlineKeyboardButton("üí≥ –û–ø–ª–∞—Ç–∏—Ç—å", url=payment_url)],
            [InlineKeyboardButton("üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É", callback_data=f'check_payment_{payment_id}')],
            [InlineKeyboardButton("¬´ –ù–∞–∑–∞–¥", callback_data='back_to_menu')]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        
        await query.edit_message_text(
            text=f"üí≥ <b>–û–ø–ª–∞—Ç–∞ –ø–æ–¥–ø–∏—Å–∫–∏</b>\n\n"
                 f"–¢–∞—Ä–∏—Ñ: <b>{tariff_name}</b>\n"
                 f"–°—É–º–º–∞: <b>{price} ‚ÇΩ</b>\n\n"
                 f"–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–û–ø–ª–∞—Ç–∏—Ç—å¬ª –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã.\n\n"
                 f"–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –Ω–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É¬ª –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞.\n\n"
                 f"üí° <i>–ü–ª–∞—Ç—ë–∂ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –Æ–ö–∞—Å—Å–∞</i>",
            parse_mode='HTML',
            reply_markup=reply_markup
        )
    else:
        await query.edit_message_text(
            text="‚ùå <b>–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞</b>\n\n"
                 "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç—ë–∂. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.\n\n"
                 "–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.",
            parse_mode='HTML'
        )


def check_yookassa_payment(payment_id: str):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –≤ –Æ–ö–∞—Å—Å–∞
    
    Args:
        payment_id: ID –ø–ª–∞—Ç–µ–∂–∞ –Æ–ö–∞—Å—Å–∞
    
    Returns:
        dict: –î–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∞ –∏–ª–∏ None –ø—Ä–∏ –æ—à–∏–±–∫–µ
    """
    if not YOOKASSA_AVAILABLE:
        return None
    
    try:
        payment = YooKassaPayment.find_one(payment_id)
        
        return {
            'id': payment.id,
            'status': payment.status,
            'paid': payment.paid,
            'amount': payment.amount.value if payment.amount else None,
            'metadata': payment.metadata
        }
        
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–∞: {e}")
        return None


async def button_callback(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ inline –∫–Ω–æ–ø–∫–∏
    
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞ –∏ —Å–æ–∑–¥–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã —á–µ—Ä–µ–∑ Django API.
    """
    query = update.callback_query
    await query.answer()
    
    user = query.from_user
    action = query.data
    
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user.id} –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É: {action}")
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    if action == 'accept_all_documents':
        mark_terms_accepted(user.id)
        await query.edit_message_text(
            text="‚úÖ <b>–í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–∏–Ω—è—Ç—ã!</b>\n\n"
                 "–°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–∏–Ω—è—Ç–∏–µ —É—Å–ª–æ–≤–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ—Ç–∫–∞–∑–∞ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.\n\n"
                 "–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å —Ç–∞—Ä–∏—Ñ.",
            parse_mode='HTML'
        )
        await asyncio.sleep(1)
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é —Å —Ç–∞—Ä–∏—Ñ–∞–º–∏
        await show_tariff_menu(update, context)
        return
    
    elif action == 'reject_terms':
        await query.edit_message_text(
            text="‚ùå <b>–û—Ñ–µ—Ä—Ç–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞</b>\n\n"
                 "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω—è—Ç—å —É—Å–ª–æ–≤–∏—è –æ—Ñ–µ—Ä—Ç—ã.\n\n"
                 "–ï—Å–ª–∏ –≤—ã –ø–µ—Ä–µ–¥—É–º–∞–µ—Ç–µ, –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ–π /start –µ—â–µ —Ä–∞–∑.",
            parse_mode='HTML'
        )
        logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user.id} –æ—Ç–∫–ª–æ–Ω–∏–ª –æ—Ñ–µ—Ä—Ç—É")
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∏–Ω—è–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π
    if action in ['buy_basic', 'buy_pro', 'buy_unlimited']:
        if not has_accepted_terms(user.id):
            await query.answer(
                "‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω—è—Ç—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start",
                show_alert=True
            )
            return
    
    if action == 'demo_free':
        # –î–ª—è –¥–µ–º–æ —Ç–æ–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–Ω—è—Ç–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
        if not has_accepted_terms(user.id):
            await query.answer(
                "‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω—è—Ç—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start",
                show_alert=True
            )
            return
        await process_demo_token(query, context)
    
    elif action == 'buy_basic':
        await handle_payment(query, context, 'BASIC', 590)
    
    elif action == 'buy_pro':
        await handle_payment(query, context, 'PRO', 1190)
    
    elif action == 'buy_unlimited':
        await handle_payment(query, context, 'UNLIMITED', 2490)
    
    elif action == 'buy_monthly':  # Legacy –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        await handle_payment(query, context, 'BASIC', 590)
    
    elif action.startswith('check_payment_'):
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
        payment_id = action.replace('check_payment_', '')
        
        await query.edit_message_text(
            text="‚è≥ <b>–ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞...</b>",
            parse_mode='HTML'
        )
        
        payment_info = check_yookassa_payment(payment_id)
        
        if payment_info and payment_info.get('status') == 'succeeded':
            # –ü–ª–∞—Ç—ë–∂ —É—Å–ø–µ—à–µ–Ω! –°–æ–∑–¥–∞—ë–º —Ç–æ–∫–µ–Ω
            user = query.from_user
            
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ç–∞—Ä–∏—Ñ–∞ –∏–∑ metadata –∏–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            metadata = payment_info.get('metadata', {})
            tariff_type = metadata.get('tariff', context.user_data.get('tariff_type', 'BASIC'))
            
            # –ü–µ—Ä–µ–¥–∞–µ–º telegram_user_id –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –º—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç–æ–≤
            token_data = create_token_via_api(tariff_type, telegram_user_id=user.id)
            
            if token_data:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤–µ—Ä–Ω—É–ª–∞—Å—å –ª–∏ –æ—à–∏–±–∫–∞ –æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–æ–¥–ø–∏—Å–∫–µ
                if 'error' in token_data:
                    if token_data.get('error') == 'Active subscription exists':
                        existing_url = token_data.get('existing_token_url', '')
                        sub_type = token_data.get('subscription_type', '')
                        next_renewal = token_data.get('next_renewal', '')
                        existing_text = (
                            f"‚ö†Ô∏è <b>–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞!</b>\n\n"
                            f"–¢–∞—Ä–∏—Ñ: <b>{sub_type}</b>\n"
                            f"–°–ª–µ–¥—É—é—â–µ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: {next_renewal}\n\n"
                            f"üîó <b>–í–∞—à–∞ —Å—Å—ã–ª–∫–∞:</b>\n{existing_url}\n\n"
                            "üí° <i>–î–æ–∂–¥–∏—Ç–µ—Å—å –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç–µ–∫—É—â–µ–π –ø–æ–¥–ø–∏—Å–∫–∏ –∏–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç–µ –µ—ë.</i>"
                        )
                        await query.edit_message_text(
                            text=existing_text,
                            parse_mode='HTML'
                        )
                        return
                
                token_url = token_data.get('url')
                expires_at = token_data.get('expires_at')
                
                tariff_names = {
                    'BASIC': ('–ë–∞–∑–æ–≤—ã–π', 590),
                    'PRO': ('–ü—Ä–æ', 1190),
                    'UNLIMITED': ('–ë–µ–∑–ª–∏–º–∏—Ç', 2490)
                }
                tariff_name, tariff_price = tariff_names.get(tariff_type, (tariff_type, 0))
                
                try:
                    if expires_at:
                        expires_dt = datetime.fromisoformat(expires_at.replace('Z', '+00:00'))
                        expires_str = expires_dt.strftime('%d.%m.%Y %H:%M')
                    else:
                        expires_str = "–±–µ—Å—Å—Ä–æ—á–Ω–æ"
                except:
                    expires_str = expires_at if expires_at else "–±–µ—Å—Å—Ä–æ—á–Ω–æ"
                
                await query.edit_message_text(
                    text="‚úÖ <b>–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!</b>\n\n"
                         f"üìù <b>–í–∞—à —Ç–∞—Ä–∏—Ñ:</b> {tariff_name}\n"
                         f"üí∞ <b>–û–ø–ª–∞—á–µ–Ω–æ:</b> {tariff_price} ‚ÇΩ\n\n"
                         f"üîó <b>–í–∞—à–∞ —Å—Å—ã–ª–∫–∞:</b>\n{token_url}\n\n"
                         f"üìÖ <b>–ê–∫—Ç–∏–≤–Ω–∞ –¥–æ:</b> {expires_str}\n\n"
                         f"üí° <i>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É - –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ª–æ–≥–∏–Ω!</i>",
                    parse_mode='HTML'
                )
                
                # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –≤ Django
                try:
                    url = f"{DJANGO_API_URL}/api/payments/{payment_id}/confirm/"
                    headers = {'X-API-Key': DJANGO_API_KEY} if DJANGO_API_KEY else {}
                    requests.post(url, json={'token_uuid': token_data.get('token')}, headers=headers, timeout=10)
                except Exception as e:
                    logger.error(f"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞: {e}")
            else:
                await query.edit_message_text(
                    text="‚úÖ <b>–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!</b>\n\n"
                         "‚ùå –ù–æ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞.\n\n"
                         "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏ —É–∫–∞–∂–∏—Ç–µ ID –ø–ª–∞—Ç–µ–∂–∞:\n"
                         f"<code>{payment_id}</code>",
                    parse_mode='HTML'
                )
        
        elif payment_info and payment_info.get('status') == 'pending':
            # –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã
            keyboard = [
                [InlineKeyboardButton("üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—â—ë —Ä–∞–∑", callback_data=f'check_payment_{payment_id}')],
                [InlineKeyboardButton("¬´ –ù–∞–∑–∞–¥", callback_data='back_to_menu')]
            ]
            reply_markup = InlineKeyboardMarkup(keyboard)
            
            await query.edit_message_text(
                text="‚è≥ <b>–û–∂–∏–¥–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã</b>\n\n"
                     "–ü–ª–∞—Ç—ë–∂ –µ—â—ë –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω.\n\n"
                     "–ï—Å–ª–∏ –≤—ã —É–∂–µ –æ–ø–ª–∞—Ç–∏–ª–∏, –ø–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—â—ë —Ä–∞–∑¬ª.",
                parse_mode='HTML',
                reply_markup=reply_markup
            )
        
        elif payment_info and payment_info.get('status') == 'canceled':
            await query.edit_message_text(
                text="‚ùå <b>–ü–ª–∞—Ç—ë–∂ –æ—Ç–º–µ–Ω—ë–Ω</b>\n\n"
                     "–ü–ª–∞—Ç—ë–∂ –±—ã–ª –æ—Ç–º–µ–Ω—ë–Ω –∏–ª–∏ –∏—Å—Ç—ë–∫ —Å—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã.\n\n"
                     "–í—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂ –∫–æ–º–∞–Ω–¥–æ–π /start",
                parse_mode='HTML'
            )
        
        else:
            await query.edit_message_text(
                text="‚ùå <b>–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–∞</b>\n\n"
                     "–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞.\n\n"
                     "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.",
                parse_mode='HTML'
            )
    
    elif action == 'back_to_menu':
        await show_main_menu(update, context)
    elif action == 'menu_tariffs':
        await show_tariff_menu(update, context)
    elif action == 'menu_my_tokens':
        # –ú–æ–∏ —Ç–æ–∫–µ–Ω—ã ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞—Ä–∏—Ñ—ã (–ø–æ–ª—É—á–∏—Ç—å/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Å—ã–ª–∫—É)
        await show_tariff_menu(update, context)
    elif action == 'menu_support_placeholder':
        await query.answer(
            "–°—Å—ã–ª–∫–∞ –Ω–∞ –≥—Ä—É–ø–ø—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞. –î–æ–±–∞–≤—å—Ç–µ TELEGRAM_SUPPORT_GROUP_URL –≤ .env",
            show_alert=True
        )
    elif action == 'menu_review':
        context.user_data['awaiting_review'] = True
        await query.edit_message_text(
            text="‚≠ê <b>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</b>\n\n"
                 "–ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞ –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.\n"
                 "–û—Ü–µ–Ω–∫—É –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤ –∫–æ–Ω—Ü–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä: <i>–û—Ç–ª–∏—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å! 5</i>",
            parse_mode='HTML'
        )


# --- –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã –≤ –≥—Ä—É–ø–ø–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ -> –æ—Ç–≤–µ—Ç) ---
SUPPORT_AUTO_REPLIES = {
    '–æ–ø–ª–∞—Ç–∞': "üí≥ –û–ø–ª–∞—Ç–∞: –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ –≤ –±–æ—Ç–µ (@ghostwriter_bot) ‚Üí –û–ø–ª–∞—Ç–∏—Ç—å. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –Ω–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É¬ª –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏.",
    '—Ç–æ–∫–µ–Ω': "üé´ –°—Å—ã–ª–∫–∞ —Å —Ç–æ–∫–µ–Ω–æ–º –≤—ã–¥–∞—ë—Ç—Å—è –≤ –±–æ—Ç–µ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –∏–ª–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ ¬´–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å—Ç–∞—Ä—Ç¬ª. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ—ë ‚Äî –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –≤—Ö–æ–¥.",
    '–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç': "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ: 1) –°—Å—ã–ª–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ —Ç–æ–π –∂–µ —Å—Å—ã–ª–∫–µ –∏–∑ –±–æ—Ç–∞. 2) –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –≤ –ª–∏—á–∫—É –±–æ—Ç—É —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º.",
    '–ø–æ–¥–ø–∏—Å–∫–∞': "–ü–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –û—Ç–º–µ–Ω–∏—Ç—å –º–æ–∂–Ω–æ –≤ –±–æ—Ç–µ. –í–æ–ø—Ä–æ—Å—ã –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º ‚Äî –≤ –ª–∏—á–∫—É –±–æ—Ç—É.",
    '–ø–æ–º–æ—â—å': "–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å –∏–ª–∏ –≤ –ª–∏—á–∫—É –±–æ—Ç—É. –î–ª—è –ª–∏—á–Ω–æ–≥–æ —á–∞—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /support.",
}


async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π: —Ñ–æ—Ä–º–∞ –æ—Ç–∑—ã–≤–∞ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏."""
    if not update.message or not update.message.text:
        return
    user = update.effective_user
    chat = update.effective_chat
    text = (update.message.text or "").strip()
    # –õ–∏—á–∫–∞: –æ–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞
    if chat.type == "private" and context.user_data.get('awaiting_review'):
        context.user_data.pop('awaiting_review', None)
        if not text:
            await update.message.reply_html("–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º. –ù–∞–ø–∏—à–∏—Ç–µ —Å–Ω–æ–≤–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ /start.")
            return
        # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –≤ –∫–æ–Ω—Ü–µ: "–¢–µ–∫—Å—Ç 5" –∏–ª–∏ "–¢–µ–∫—Å—Ç ‚òÖ5"
        rating = None
        import re
        m = re.search(r'[‚òÖ*]?\s*([1-5])\s*$', text)
        if m:
            rating = int(m.group(1))
            text = text[:m.start()].strip()
        if not text:
            await update.message.reply_html("–ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞.")
            return
        result = save_review_via_api(user.id, user.username, text, rating)
        if result:
            await update.message.reply_html(
                "‚úÖ <b>–°–ø–∞—Å–∏–±–æ!</b> –í–∞—à –æ—Ç–∑—ã–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é."
            )
        else:
            await update.message.reply_html(
                "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É."
            )
        return
    # –ì—Ä—É–ø–ø–∞/—Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞: –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã –∏ /support
    if chat.type in ("group", "supergroup"):
        # –ö–æ–º–∞–Ω–¥–∞ /support ‚Äî —Å–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–∞–ø–∏—Å–∞—Ç—å –≤ –ª–∏—á–∫—É
        if text.startswith("/support") or text.strip().lower() == "/support":
            save_support_ticket_via_api(
                user.id, user.username,
                message="–ó–∞–ø—Ä–æ—Å –ø—Ä–∏–≤–∞—Ç–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏–∑ –≥—Ä—É–ø–ø—ã",
                subject="–ó–∞–ø—Ä–æ—Å –∏–∑ –≥—Ä—É–ø–ø—ã",
                source="group"
            )
            bot_username = (await context.bot.get_me()).username
            await update.message.reply_html(
                f"üí¨ –î–ª—è –ª–∏—á–Ω–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–∞–ø–∏—à–∏—Ç–µ –≤ –ª–∏—á–∫—É –±–æ—Ç—É: @{bot_username}\n"
                "–û–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å —Ç–∞–º ‚Äî –º—ã –æ—Ç–≤–µ—Ç–∏–º."
            )
            return
        # –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
        lower = text.lower()
        for keyword, reply in SUPPORT_AUTO_REPLIES.items():
            if keyword in lower:
                await update.message.reply_text(reply)
                return


async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
    help_text = (
        "ü§ñ <b>Ghostwriter Bot - –°–ø—Ä–∞–≤–∫–∞</b>\n\n"
        "<b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n"
        "/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É –∏ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω\n"
        "/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É\n"
        "/plans - –ü–æ–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã\n\n"
        "<b>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</b>\n"
        "1. –ù–∞–∂–º–∏—Ç–µ /start\n"
        "2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ\n"
        "3. –ü–æ–ª—É—á–∏—Ç–µ —Å—Å—ã–ª–∫—É —Å —Ç–æ–∫–µ–Ω–æ–º\n"
        "4. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ\n"
        "5. –ù–∞—á–Ω–∏—Ç–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç!\n\n"
        "üí° <i>–ù–∏–∫–∞–∫–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è</i>"
    )
    
    await update.message.reply_html(help_text)


async def plans_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /plans - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã"""
    plans_text = (
        "üìã <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã Ghostwriter</b>\n\n"
        "üÜì <b>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å—Ç–∞—Ä—Ç</b>\n"
        "‚Ä¢ GigaChat: 10 000 —Ç–æ–∫–µ–Ω–æ–≤\n"
        "‚Ä¢ OpenAI: 500 —Ç–æ–∫–µ–Ω–æ–≤\n"
        "‚Ä¢ –°—Ä–æ–∫: –±–µ—Å—Å—Ä–æ—á–Ω–æ\n"
        "‚Ä¢ –¶–µ–Ω–∞: –ë–µ—Å–ø–ª–∞—Ç–Ω–æ\n\n"
        "üìä <b>–ë–∞–∑–æ–≤—ã–π</b> - 500‚ÇΩ/–º–µ—Å\n"
        "‚Ä¢ GigaChat: 50 000 —Ç–æ–∫–µ–Ω–æ–≤\n"
        "‚Ä¢ OpenAI: 3 000 —Ç–æ–∫–µ–Ω–æ–≤\n"
        "‚Ä¢ –°—Ä–æ–∫: 30 –¥–Ω–µ–π (–ø–æ–¥–ø–∏—Å–∫–∞)\n\n"
        "‚≠ê <b>–ü—Ä–æ</b> - 1 500‚ÇΩ/–º–µ—Å\n"
        "‚Ä¢ GigaChat: 200 000 —Ç–æ–∫–µ–Ω–æ–≤\n"
        "‚Ä¢ OpenAI: 15 000 —Ç–æ–∫–µ–Ω–æ–≤\n"
        "‚Ä¢ –°—Ä–æ–∫: 30 –¥–Ω–µ–π (–ø–æ–¥–ø–∏—Å–∫–∞)\n\n"
        "üöÄ <b>–ë–µ–∑–ª–∏–º–∏—Ç</b> - 3 500‚ÇΩ/–º–µ—Å\n"
        "‚Ä¢ GigaChat: –±–µ–∑–ª–∏–º–∏—Ç\n"
        "‚Ä¢ OpenAI: 50 000 —Ç–æ–∫–µ–Ω–æ–≤\n"
        "‚Ä¢ –°—Ä–æ–∫: 30 –¥–Ω–µ–π (–ø–æ–¥–ø–∏—Å–∫–∞)\n\n"
        "üí° <i>–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start</i>"
    )
    
    await update.message.reply_html(plans_text)


async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫"""
    logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: {context.error}")
    
    if update and update.effective_message:
        await update.effective_message.reply_text(
            "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.\n"
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É."
        )


def main_polling():
    """
    –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ polling —Ä–µ–∂–∏–º–µ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
    
    –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –±–æ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç Telegram API –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
    –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
    """
    logger.info("üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ polling —Ä–µ–∂–∏–º–µ...")
    
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    application = Application.builder().token(BOT_TOKEN).build()
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
    application.add_handler(CommandHandler("start", start_command))
    application.add_handler(CommandHandler("help", help_command))
    application.add_handler(CommandHandler("plans", plans_command))
    application.add_handler(CommandHandler("support", start_command))  # /support –≤ –ª–∏—á–∫–µ ‚Äî –≤ –º–µ–Ω—é
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ inline –∫–Ω–æ–ø–æ–∫
    application.add_handler(CallbackQueryHandler(button_callback))
    
    # –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è: —Ñ–æ—Ä–º–∞ –æ—Ç–∑—ã–≤–∞ –∏ –≥—Ä—É–ø–ø–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
    application.add_error_handler(error_handler)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    logger.info("‚úÖ –ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω! –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.")
    application.run_polling(allowed_updates=Update.ALL_TYPES)


def set_webhook():
    """
    –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook –¥–ª—è production —Ä–µ–∂–∏–º–∞
    
    –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π URL,
    –∞ Django webhook –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö —á–µ—Ä–µ–∑ views.telegram_webhook
    """
    import requests
    
    if not WEBHOOK_URL:
        logger.error("‚ùå TELEGRAM_WEBHOOK_URL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ .env —Ñ–∞–π–ª–µ!")
        return
    
    logger.info(f"üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook: {WEBHOOK_URL}")
    
    url = f"https://api.telegram.org/bot{BOT_TOKEN}/setWebhook"
    
    data = {
        'url': WEBHOOK_URL,
    }
    
    # –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
    if WEBHOOK_SECRET:
        data['secret_token'] = WEBHOOK_SECRET
    
    try:
        response = requests.post(url, json=data)
        result = response.json()
        
        if result.get('ok'):
            logger.info("‚úÖ Webhook —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
            logger.info(f"üìç URL: {WEBHOOK_URL}")
            if WEBHOOK_SECRET:
                logger.info(f"üîê Secret token: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        else:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ webhook: {result}")
    
    except Exception as e:
        logger.error(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ webhook: {e}")


def delete_webhook():
    """–£–¥–∞–ª–µ–Ω–∏–µ webhook"""
    import requests
    
    logger.info("üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ webhook...")
    
    url = f"https://api.telegram.org/bot{BOT_TOKEN}/deleteWebhook"
    
    try:
        response = requests.post(url)
        result = response.json()
        
        if result.get('ok'):
            logger.info("‚úÖ Webhook —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω!")
        else:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è webhook: {result}")
    
    except Exception as e:
        logger.error(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ webhook: {e}")


def get_webhook_info():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º webhook"""
    import requests
    
    logger.info("‚ÑπÔ∏è –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ webhook...")
    
    url = f"https://api.telegram.org/bot{BOT_TOKEN}/getWebhookInfo"
    
    try:
        response = requests.get(url)
        result = response.json()
        
        if result.get('ok'):
            webhook_info = result['result']
            logger.info("‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ webhook:")
            logger.info(f"   URL: {webhook_info.get('url', '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω')}")
            logger.info(f"   Pending updates: {webhook_info.get('pending_update_count', 0)}")
            logger.info(f"   –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞: {webhook_info.get('last_error_message', '–Ω–µ—Ç')}")
        else:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: {result}")
    
    except Exception as e:
        logger.error(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: {e}")


if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Telegram –±–æ—Ç –¥–ª—è Ghostwriter')
    parser.add_argument('--set-webhook', action='store_true', help='–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook –¥–ª—è production')
    parser.add_argument('--delete-webhook', action='store_true', help='–£–¥–∞–ª–∏—Ç—å webhook')
    parser.add_argument('--webhook-info', action='store_true', help='–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ webhook')
    
    args = parser.parse_args()
    
    if args.set_webhook:
        set_webhook()
    elif args.delete_webhook:
        delete_webhook()
    elif args.webhook_info:
        get_webhook_info()
    else:
        # –ó–∞–ø—É—Å–∫ –≤ polling —Ä–µ–∂–∏–º–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
        main_polling()
