#!/bin/bash
# –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Ghostwriter –ø—Ä–æ–µ–∫—Ç–∞
# Django –Ω–∞ —Ä–æ—Å—Å–∏–π—Å–∫–æ–º —Å–µ—Ä–≤–µ—Ä–µ + Flask –Ω–∞ –∑–∞—Ä—É–±–µ–∂–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ

set -e

echo "üåç –ü–û–õ–ù–û–ï –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï GHOSTWRITER –ü–†–û–ï–ö–¢–ê"
echo "=================================================================="
echo "üìã –ü–õ–ê–ù –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Ø:"
echo "1. üá∑üá∫ Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí –†–æ—Å—Å–∏–π—Å–∫–∏–π —Å–µ—Ä–≤–µ—Ä (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)"
echo "2. üåê Flask AI –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å ‚Üí –ó–∞—Ä—É–±–µ–∂–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (OpenAI API)"
echo "3. üîê –®–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–≤—è–∑—å –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏"
echo "=================================================================="
echo ""

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
show_deployment_instructions() {
    echo "üìù –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Æ:"
    echo ""
    echo "üá∑üá∫ –†–û–°–°–ò–ô–°–ö–ò–ô –°–ï–†–í–ï–† (Django):"
    echo "--------------------------------"
    echo "1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Å–µ—Ä–≤–µ—Ä"
    echo "2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª —Å —Ä–æ—Å—Å–∏–π—Å–∫–∏–º–∏ API –∫–ª—é—á–∞–º–∏:"
    echo "   GIGACHAT_CLIENT_ID=your-gigachat-id"
    echo "   GIGACHAT_CLIENT_SECRET=your-gigachat-secret"
    echo "   FLASK_EXTERNAL_URL=https://your-foreign-server.com"
    echo "3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: ./deploy/deploy-django.sh"
    echo ""
    echo "üåê –ó–ê–†–£–ë–ï–ñ–ù–´–ô –°–ï–†–í–ï–† (Flask AI):"
    echo "--------------------------------"
    echo "1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–∞–ø–∫—É flask_generator –Ω–∞ –∑–∞—Ä—É–±–µ–∂–Ω—ã–π —Å–µ—Ä–≤–µ—Ä"
    echo "2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ flask_generator/.env:"
    echo "   OPENAI_API_KEY=your-openai-key"
    echo "   GENERATOR_ENCRYPTION_KEY=k6W1hS1TpK-fOe-1pEGSSXmSDHkQNrpsI-TfuL-7EHI="
    echo "3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: ./deploy/deploy-flask.sh"
    echo ""
    echo "üîó –ù–ê–°–¢–†–û–ô–ö–ê –°–í–Ø–ó–ò:"
    echo "-------------------"
    echo "1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Å–æ–≤–ø–∞–¥–∞—é—Ç –≤ –æ–±–æ–∏—Ö .env —Ñ–∞–π–ª–∞—Ö"
    echo "2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è HTTPS"
    echo "3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Flask —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
    echo ""
    echo "‚öñÔ∏è –°–û–ë–õ–Æ–î–ï–ù–ò–ï 152-–§–ó:"
    echo "---------------------"
    echo "‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –†–§ (Django —Å–µ—Ä–≤–µ—Ä)"
    echo "‚úÖ AI –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –∑–∞—Ä—É–±–µ–∂–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ (—Ç–æ–ª—å–∫–æ –æ–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)"
    echo "‚úÖ –®–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏"
    echo "‚úÖ –ù–µ—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ AI —Å–µ—Ä–≤–∏—Å"
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è
echo "üîç –ü–†–û–í–ï–†–ö–ê –¢–ï–ö–£–©–ï–ì–û –°–ï–†–í–ï–†–ê:"
echo "-----------------------------"

# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã –ø–æ IP (–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ)
COUNTRY=$(curl -s ipinfo.io/country 2>/dev/null || echo "UNKNOWN")
echo "–°—Ç—Ä–∞–Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞: $COUNTRY"

if [ "$COUNTRY" = "RU" ]; then
    echo "üá∑üá∫ –û–±–Ω–∞—Ä—É–∂–µ–Ω —Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Å–µ—Ä–≤–µ—Ä - –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
    echo ""
    
    read -p "ü§î –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —ç—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–µ? (y/N): " response
    if [[ "$response" =~ ^[Yy]$ ]]; then
        echo "üöÄ –ó–∞–ø—É—Å–∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Django..."
        ./deploy/deploy-django.sh
    else
        echo "‚ÑπÔ∏è  –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º"
    fi
    
elif [ "$COUNTRY" != "RU" ] && [ "$COUNTRY" != "UNKNOWN" ]; then
    echo "üåê –û–±–Ω–∞—Ä—É–∂–µ–Ω –∑–∞—Ä—É–±–µ–∂–Ω—ã–π —Å–µ—Ä–≤–µ—Ä - –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è Flask AI –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞"
    echo ""
    
    read -p "ü§î –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å Flask AI –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞ —ç—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–µ? (y/N): " response
    if [[ "$response" =~ ^[Yy]$ ]]; then
        echo "üöÄ –ó–∞–ø—É—Å–∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Flask..."
        cd flask_generator
        ../deploy/deploy-flask.sh
    else
        echo "‚ÑπÔ∏è  –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º"
    fi
    
else
    echo "‚ùì –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞"
    echo ""
    echo "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:"
    echo "1) Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Å–µ—Ä–≤–µ—Ä)"
    echo "2) Flask AI –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å (–∑–∞—Ä—É–±–µ–∂–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)"
    echo "3) –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"
    echo ""
    
    read -p "–í–∞—à –≤—ã–±–æ—Ä (1/2/3): " choice
    
    case $choice in
        1)
            echo "üá∑üá∫ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
            ./deploy/deploy-django.sh
            ;;
        2)
            echo "üåê –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Flask AI –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞..."
            cd flask_generator
            ../deploy/deploy-flask.sh
            ;;
        3)
            show_deployment_instructions
            ;;
        *)
            echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
            exit 1
            ;;
    esac
fi

echo ""
show_deployment_instructions

echo ""
echo "üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:"
echo "1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è HTTPS"
echo "2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏"
echo "3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ"
echo "4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –±—ç–∫–∞–ø—ã"
echo ""
echo "üìö –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: README.md"
